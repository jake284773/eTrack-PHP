{% extends "layouts.list-sidebar" %}

{% block title %}Manage user accounts{% endblock %}

{% block sidebar %}
  <div class="well">
    <h4 class="page-title-no-top">Filter list by:</h4>
    {% autoescape false %}
      {{ form_open({'route': 'admin.users.index', 'method': 'get'}) }}
        <div class="form-group">
          {{ form_label('search', 'Search for a user', {'id': 'search-label', 'class': 'form-label'}) }}
          <div class="row">
            <div class="col-xs-8 search-box">
              {{ form_input('search', 'search', input_get('search'), {'id': 'search', 'class': 'form-control', 'placeholder': 'Search'}) }}
            </div>
            <div class="col-xs-2 search-btn">
              {{ form_button('<span class="octicon octicon-search"></span> Search', {'class': 'btn btn-primary', 'type': 'submit'}) }}
            </div>
          </div>
        </div>

        <div class="form-group">
          {{ form_label('role', 'Filter by user role', {'id': 'role-label', 'class': 'form-label'}) }}
          {{ form_select('role',
          {'': 'All roles', 'Admin': 'Admin', 'Course Organiser': 'Course Organiser', 'Tutor': 'Tutor', 'Student': 'Student'},
          input_get('role'), {'id': 'user-role', 'class': 'form-control chosen-select', 'onchange': 'this.form.submit()'})
          }}
        </div>
    {{  form_close() }}
    <a href="{{ route('admin.users.index') }}">Reset all fields</a>
  {% endautoescape %}

  <hr>

  <a href="{{ route('admin.users.create') }}" class="btn btn-primary"><span class="octicon octicon-plus"></span> Create a new user</a>
  <a href="{{ route('admin.users.import.step1') }}" class="btn btn-warning btn-vblock"><span class="octicon octicon-cloud-upload"></span> Batch import</a>

  </div>
{% endblock %}

{% block content %}
  <header class="page-header">
    <ol class="breadcrumb">
      <li><a href="{{ route('home') }}">Home</a></li>
      <li class="active">Users</li>
    </ol>
    <hgroup>
      {% if session_has('successMessage') %}
        <div class="alert alert-success">
          {{ session_get('successMessage') }}
        </div>
      {% endif %}

      {% if session_has('infoMessage') %}
        <div class="alert alert-info">
          {{ session_get('infoMessage') }}
        </div>
      {% endif %}

      {% if session_has('errorMessage') %}
        <div class="alert alert-danger">
          {{ session_get('errorMessage') }}
        </div>
      {% endif %}

      <h1 class="heading-large">Manage user accounts <span class="label label-default pull-right">{{ userCount }}</span></h1>
    </hgroup>
  </header>

  <article>
    <table class="table table-borders table-responsive">
      <thead>
      <tr>
        <th>User ID</th>
        <th>Email address</th>
        <th>Full name</th>
        <th>User role</th>
        <th></th>
      </tr>
      </thead>

      <tbody>
        {% for user in users %}
          <tr>
            <td>{{ user.id }}</td>
            <td>{{ user.email }}</td>
            <td>{{ user.full_name }}</td>
            <td>{{ user.role }}</td>
            <td>
              <a href="{{ route('admin.users.edit', user.id) }}" class="btn btn-default btn-sm"><span class="octicon octicon-pencil"></span> Edit</a>
              <a href="{{ route('admin.users.delete_confirm', user.id) }}" data-toggle="modal" data-target="#web-modal" class="btn btn-danger btn-sm"><span class="octicon octicon-x"></span> Delete</a>
            </td>
          </tr>
        {% else %}
          <tr><td colspan="5">No users have been found.</td></tr>
      {% endfor %}
      </tbody>
    </table>

    <div class="text-center">
      {% autoescape false %}
        {{ users.appends(input_all()).links() }}
      {% endautoescape %}
    </div>
  </article>
{% endblock %}
